<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="FishermenMoim">
    <meta property="og:description" content="내수동교회 청년부 어부들 모임 현황">
    <meta property="og:image" content="http://fishermenmoim.dothome.co.kr/img/fishermen_og.png">
    <meta property="og:url" content="http://fishermenmoim.dothome.co.kr/">
    <meta property="og:type" content="website">
    <link rel="apple-touch-icon" sizes="57x57" href="./img/favi/android-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="./img/favi/apple-icon-60x60.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="./img/favi/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./img/favi/favicon-16x16.png">
    <title>FishermenMoim</title>
    <link href="css/reset.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
    <div class="wrap">
        <h1 class="logo">
            <img src="./img/logo.png" alt="logo">
        </h1>
        <div class="title_wrap">
            <h2 class="title">@FishermenMoim</h2>
            <p class="title_desc">And he saith unto them, <br>Follow me, and I will make you fishers of men. <br>Matthew 4:19</p>
            <ul class="list_sns">
                <li class="item_sns item_youtube">
                    <a title="YouTube" data-testid="SocialIcon" target="_blank" rel="noopener noreferrer" href="https://youtube.com/@naesoofishermen?si=sRH2adNZru9hspJv" aria-label="YouTube" class="[&amp;svg]pointer-events-none z-0 p-2 transition-transform hover:scale-[107.5%]"><img src="./img/youtube_logo.png"><span class="sr-only">YouTube</span></a>
                </li>
                <li class="item_sns item_instagram">
                    <a title="Instagram" data-testid="SocialIcon" target="_blank" rel="noopener noreferrer" href="https://www.instagram.com/naesoofishermen/" aria-label="Instagram" class="[&amp;svg]pointer-events-none z-0 p-2 transition-transform hover:scale-[107.5%]"><img src="./img/insta_logo.png"><span class="sr-only">Instagram</span></a>
                </li>
                <li class="item_sns item_kakao">
                    <a title="kakaotalk" data-testid="SocialIcon" target="_blank" rel="noopener noreferrer" href="https://pf.kakao.com/_xibZxhC" aria-label="kakaotalk" class="[&amp;svg]pointer-events-none z-0 p-2 transition-transform hover:scale-[107.5%]"><img src="./img/kakao.png"><span class="sr-only">kakaotalk</span></a>
                </li>
            </ul>
        </div>
        <ul class="list_link" id="data-list">
            <!-- <li class="item_link">
                <button class="button" onClick="popupOpen()">
                    <img src="https://kormedi.com/wp-content/uploads/2022/04/ck_tica1010005154_l-580x387.jpg" alt="사진">
                    사진 모임
                </button>
            </li>
            <li class="item_link">
                <button class="button" onClick="popupOpen()">
                    <img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FyKdUD%2FbtsL8UyLCKH%2FKa8XSUlTpZNKMkscGvuick%2Fimg.jpg" alt="심리학">
                    심리학모임 인커
                </button>
            </li> -->
        </ul>
        <div class="footer">
            <p>어부들 인플루언서 :</p>
            <a href="https://www.instagram.com/2moksa/" target="_blank">
                <img src="./img/2moksa.png" alt="2moksa">
            </a>
        </div>
        <p class="copyright">© 2025 Fishremen. All rights reserved.</p>


    </div>

    <div class="dim">
        <div class="popup">
            <h2 class="popup_title">사진 모임</h2>
            <button class="popup_close" onClick="popupClose()"></button>
            <ul class="leader_list">
                <li class="leader">모임장: <span class="leader_name">이현석(94) / 김찬기(95)</span></li>
                <li class="leader">카톡ID:<span class="leader_name">dlgustjr94 / ckk0328</span></li>
            </ul>
            <div class="content">
                Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.
            </div>
            <div class="link_wrap">
                <a class="link" href="https://forms.gle/F7o4m5aFyYAT29BK7" target="_blank">신청 링크</a>
            </div>
        </div>
    </div>

    <script>
        setTimeout(() => {
            document.querySelector('.wrap').classList.add('on');
        }, 1000);

        let currentData = {};  // 현재 클릭한 모임의 데이터를 저장할 변수

        async function fetchGoogleSheetData() {
            try {
                const response = await fetch("https://docs.google.com/spreadsheets/d/1fZ9UU4xTD0h0CpjLigxQpI-nYSdL4bIM3pE3YuI6gH8/gviz/tq?tqx=out:json");
                const text = await response.text();
                
                // 구글 스프레드시트에서 반환된 JSONP 데이터를 JSON으로 변환
                const json = JSON.parse(text.substring(47, text.length - 2)); // Google Sheets 응답에서 불필요한 부분 제거
                const rows = json.table.rows; // 데이터 행 가져오기

                const listElement = document.getElementById("data-list");
                listElement.innerHTML = ""; // 기존 목록 초기화

                rows.forEach(row => {
                    let title = row.c[0]?.v || "";  // 모임 이름
                    let applyLink = row.c[1]?.v || "#";  // 신청 링크
                    let imageSrc = row.c[2]?.v || "";  // 이미지 URL
                    let category = row.c[3]?.v || "";  // 카테고리
                    let leaders = row.c[4]?.v || "";  // 모임장
                    let kakaoID = row.c[5]?.v || "";  // 카톡 ID
                    let contentImg = row.c[6]?.v || "";  // 모임 이미지지
                    let content = row.c[7]?.v || "";  // 모임 내용
                    let linkTitle = row.c[8]?.v || "확인";  // 버튼 이름
                    let closeLink = row.c[9]?.v || "";  // 신청 마감 여부
                    
                    if (imageSrc && !imageSrc.startsWith("http")) {
                        imageSrc = "https://cdn.ardentnews.co.kr/news/photo/202409/" + imageSrc; // 이미지 경로 조정
                    }

                    // HTML 리스트 생성
                    const li = document.createElement("li");
                    li.classList.add("item_link");

                    const button = document.createElement("button");
                    button.classList.add("button");
                    button.setAttribute("onClick", `popupOpen(${JSON.stringify({title, link: applyLink, imageSrc, category, leaders, kakaoID, contentImg, content, linkTitle, closeLink})})`);
                    
                    const img = document.createElement("img");
                    img.src = imageSrc;
                    img.alt = category;  // 카테고리 (예: "산", "독서")
                    
                    button.appendChild(img);
                    button.appendChild(document.createTextNode(title));
                    li.appendChild(button);
                    listElement.appendChild(li);

                });

            } catch (error) {
                console.error("데이터를 가져오는 중 오류 발생:", error);
            }
        }

        // 페이지 로드 시 데이터 가져오기
        fetchGoogleSheetData();

        // 팝업을 열 때 호출되는 함수
        function popupOpen(data) {
            currentData = data;  // 클릭한 모임 데이터 저장

            // body에 스크롤 방지
            document.body.style.overflow = 'hidden';

            // 팝업 내용 채우기
            document.querySelector('.popup_title').textContent = currentData.title;
            document.querySelector('.leader_list').innerHTML = ` 
                <li class="leader">모임장: <br><span class="leader_name">${currentData.leaders}</span></li>
                <li class="leader">카톡ID: <br><span class="leader_name">${currentData.kakaoID}</span></li>
            `;
            // contentImg가 있는 경우 img 태그 추가, 없으면 content 텍스트 출력
            const contentElement = document.querySelector('.content');
            contentElement.innerHTML = '';  // 기존 content 초기화
            if (currentData.contentImg) {
                const img = document.createElement('img');
                img.src = currentData.contentImg;
                img.alt = currentData.category;  // alt 태그는 모임 제목으로 설정
                contentElement.appendChild(img);  // 이미지 추가
            } else {
                const pre = document.createElement('pre');
                pre.textContent = currentData.content;  // <pre> 태그 안에 텍스트 설정
                contentElement.appendChild(pre);  // <pre> 태그 추가
            }
            
            document.querySelector('.link_wrap').innerHTML = `
                <a class="link ${currentData.closeLink}" href="${currentData.link}" target="_blank">${currentData.linkTitle}</a>
            `;

            // 팝업 열기
            document.querySelector('.dim').style.display = 'block';
        }

        // 팝업을 닫을 때 호출되는 함수
        function popupClose() {
            // 팝업 닫기
            document.querySelector('.dim').style.display = 'none';
            
            // body 스크롤 다시 활성화
            document.body.style.overflow = '';
        }

    </script>
    
    
</body>
</html>